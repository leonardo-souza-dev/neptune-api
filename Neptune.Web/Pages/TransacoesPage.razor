@page "/"

@using Neptune.Models

@inject NavigationManager UriHelper
@inject ITransacaoService TransacaoService

<h1>Transações</h1>

<button class="btn btn-primary" @onclick="@NovaTransacao">Nova Transação</button>

@if (novaTransacaoVisivel)
{
    <br/>
    <input form="Data" type="date" @bind="@novaTransacao.Data"  />
    <input form="Descricao" @bind="@novaTransacao.Descricao" />
    <input form="Valor" @bind="@novaTransacao.Valor" />
    <button class="btn btn-primary" @onclick="Nova">Salvar</button>
}

@if (Transacoes == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <table class="table">
        <thead>
            <tr>
                <th>Data</th>
                <th>Descricao</th>
                <th>Valor</th>
                <th>Editar</th>
                <th>Id</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var transacao in Transacoes)
            {
                <TransacaoComp transacao="@transacao" />
            }
        </tbody>
    </table>
}

@code {
        IList<Transacao> Transacoes { get; set; }
        //Transacao novaTransacao = new Transacao { Data = DateTime.Now };
        Transacao novaTransacao = new ();
        bool novaTransacaoVisivel = false;

    protected override async Task OnInitializedAsync() => Transacoes = await TransacaoService.ObterTransacoes();

    private void NovaTransacao()
    {
        novaTransacao = new();
        novaTransacaoVisivel = true;
    }

    private async Task Nova()
    {
        var novaTransacaoPersistida = await TransacaoService.NovaTransacao(novaTransacao);
        Transacoes.Add(novaTransacaoPersistida);
        novaTransacaoVisivel = false;
    }
}
